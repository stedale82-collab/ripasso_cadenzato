<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.1">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d6d6d; -webkit-text-stroke: #6d6d6d}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6b0001; -webkit-text-stroke: #6b0001}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #fb0007; -webkit-text-stroke: #fb0007}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0000ff; -webkit-text-stroke: #0000ff}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4d5055; -webkit-text-stroke: #4d5055}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #137646; -webkit-text-stroke: #137646}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #093c94; -webkit-text-stroke: #093c94}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6f0ec3; -webkit-text-stroke: #6f0ec3}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000; min-height: 16.0px}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #18702b; -webkit-text-stroke: #18702b}
    span.s1 {font-kerning: none}
    span.s2 {font-kerning: none; color: #fb0007; -webkit-text-stroke: 0px #fb0007}
    span.s3 {font-kerning: none; color: #2a2a2a; -webkit-text-stroke: 0px #2a2a2a}
    span.s4 {font-kerning: none; color: #000000; -webkit-text-stroke: 0px #000000}
    span.s5 {font-kerning: none; color: #0000ff; -webkit-text-stroke: 0px #0000ff}
    span.s6 {font-kerning: none; color: #6b0001; -webkit-text-stroke: 0px #6b0001}
    span.s7 {font-kerning: none; color: #18702b; -webkit-text-stroke: 0px #18702b}
    span.s8 {font-kerning: none; color: #093c94; -webkit-text-stroke: 0px #093c94}
    span.s9 {font-kerning: none; color: #137646; -webkit-text-stroke: 0px #137646}
    span.s10 {font-kerning: none; color: #6f0ec3; -webkit-text-stroke: 0px #6f0ec3}
    span.s11 {font-kerning: none; color: #0e6e6d; -webkit-text-stroke: 0px #0e6e6d}
    span.s12 {font-kerning: none; color: #a4450b; -webkit-text-stroke: 0px #a4450b}
    span.s13 {font-kerning: none; color: #4d5055; -webkit-text-stroke: 0px #4d5055}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"it"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">Gestione Ripasso Intelligente</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&amp;display=swap"</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s7">'Inter'</span><span class="s1">, </span><span class="s8">sans-serif</span><span class="s1">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s4"> </span><span class="s8">#f7f9fb</span><span class="s4">; </span><span class="s1">/* Sfondo chiaro */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#1e293b</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.container</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">max-width:</span><span class="s1"> </span><span class="s9">1000px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.card</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">/* Ombre più marcate */</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s4"> </span><span class="s1">0</span><span class="s4"> </span><span class="s1">10px</span><span class="s4"> </span><span class="s1">15px</span><span class="s4"> </span><span class="s1">-3px</span><span class="s4"> </span><span class="s8">rgba(</span><span class="s1">0</span><span class="s4">, </span><span class="s1">0</span><span class="s4">, </span><span class="s1">0</span><span class="s4">, </span><span class="s1">0.1</span><span class="s8">)</span><span class="s4">, </span><span class="s1">0</span><span class="s4"> </span><span class="s1">4px</span><span class="s4"> </span><span class="s1">6px</span><span class="s4"> </span><span class="s1">-2px</span><span class="s4"> </span><span class="s8">rgba(</span><span class="s1">0</span><span class="s4">, </span><span class="s1">0</span><span class="s4">, </span><span class="s1">0</span><span class="s4">, </span><span class="s1">0.05</span><span class="s8">)</span><span class="s4">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">border-radius:</span><span class="s4"> </span><span class="s9">0.75rem</span><span class="s4">; </span><span class="s1">/* rounded-xl */</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">transform</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s4">, </span><span class="s1">box-shadow</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.card:hover</span><span class="s4"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">transform:</span><span class="s1"> </span><span class="s8">translateY(</span><span class="s9">-2px</span><span class="s8">)</span><span class="s1">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s4"> </span><span class="s1">0</span><span class="s4"> </span><span class="s1">15px</span><span class="s4"> </span><span class="s1">20px</span><span class="s4"> </span><span class="s1">-5px</span><span class="s4"> </span><span class="s8">rgba(</span><span class="s1">0</span><span class="s4">, </span><span class="s1">0</span><span class="s4">, </span><span class="s1">0</span><span class="s4">, </span><span class="s1">0.15</span><span class="s8">)</span><span class="s4">, </span><span class="s1">0</span><span class="s4"> </span><span class="s1">6px</span><span class="s4"> </span><span class="s1">10px</span><span class="s4"> </span><span class="s1">-4px</span><span class="s4"> </span><span class="s8">rgba(</span><span class="s1">0</span><span class="s4">, </span><span class="s1">0</span><span class="s4">, </span><span class="s1">0</span><span class="s4">, </span><span class="s1">0.08</span><span class="s8">)</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Stile Pulsante Giallo */</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-primary</span><span class="s4"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s4"> </span><span class="s8">#facc15</span><span class="s4">; </span><span class="s1">/* Giallo (yellow-400) */</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s4"> </span><span class="s8">#000000</span><span class="s4">; </span><span class="s1">/* Testo Nero */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s9">700</span><span class="s1">;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s9">0.15s</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-primary:hover</span><span class="s4"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s4"> </span><span class="s8">#eab308</span><span class="s4">; </span><span class="s1">/* Giallo più scuro al passaggio (yellow-600) */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Stile Pulsante Secondario (Apri File) */</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-secondary</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s4"> </span><span class="s8">#f1f5f9</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#4f46e5</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">1px</span><span class="s1"> </span><span class="s8">solid</span><span class="s1"> </span><span class="s8">#4f46e5</span><span class="s1">;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s9">0.15s</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-secondary:hover</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s4"> </span><span class="s8">#e2e8f0</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Stile Pulsante Ripasso */</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-review</span><span class="s4"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s4"> </span><span class="s8">#10b981</span><span class="s4">; </span><span class="s1">/* Smeraldo (Emerald) */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">white</span><span class="s1">;<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s9">600</span><span class="s1">;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s9">0.15s</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-review:hover</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s4"> </span><span class="s8">#059669</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.loader</span><span class="s1"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-top-color:</span><span class="s4"> </span><span class="s8">#4f46e5</span><span class="s4">;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">-webkit-animation:</span><span class="s4"> </span><span class="s1">spinner</span><span class="s4"> </span><span class="s9">1.5s</span><span class="s4"> </span><span class="s1">linear</span><span class="s4"> </span><span class="s1">infinite</span><span class="s4">;</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s4"> </span><span class="s1">spinner</span><span class="s4"> </span><span class="s9">1.5s</span><span class="s4"> </span><span class="s1">linear</span><span class="s4"> </span><span class="s1">infinite</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">@-webkit-keyframes</span><span class="s4"> </span><span class="s8">spinner</span><span class="s4"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">0%</span><span class="s1"> { </span><span class="s2">-webkit-transform:</span><span class="s1"> </span><span class="s8">rotate(</span><span class="s9">0deg</span><span class="s8">)</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">100%</span><span class="s1"> { </span><span class="s2">-webkit-transform:</span><span class="s1"> </span><span class="s8">rotate(</span><span class="s9">360deg</span><span class="s8">)</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s1"> </span><span class="s8">spinner</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">0%</span><span class="s1"> { </span><span class="s2">transform:</span><span class="s1"> </span><span class="s8">rotate(</span><span class="s9">0deg</span><span class="s8">)</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">100%</span><span class="s1"> { </span><span class="s2">transform:</span><span class="s1"> </span><span class="s8">rotate(</span><span class="s9">360deg</span><span class="s8">)</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.file-icon</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s9">20px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s9">20px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">margin-right:</span><span class="s1"> </span><span class="s9">8px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 md:p-8"</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"app"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"container mx-auto"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">header</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center mb-8"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-4xl font-black text-indigo-700 mb-2"</span><span class="s3">&gt;</span><span class="s4">MyNotes SRS</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-gray-500"</span><span class="s3">&gt;</span><span class="s1">Sistema di Ripasso Spaziato (Spaced Repetition) per i tuoi file. Carica, nomina e ripassa.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">header</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Sezione Caricamento File e Nome Promemoria (Azione Unica) --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"card bg-white p-6 rounded-xl mb-8"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-semibold mb-4 text-indigo-600"</span><span class="s3">&gt;</span><span class="s4">Carica File e Inizia Ripasso</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"memoNameInput"</span><span class="s4"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"Assegna un nome al promemoria (es. Curva di Apprendimento)"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 mb-4"</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"file"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"fileInput"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-4 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 p-2.5"</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"uploadFileButton"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn-primary w-full font-semibold py-2 px-4 rounded-lg hover:shadow-lg"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>Carica File e Salva Promemoria (Primo Ripasso: Oggi)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"fileUploadMessage"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-3 text-sm font-medium"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-sm text-gray-500 mt-2"</span><span class="s3">&gt;</span><span class="s4">ID Utente: </span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"userIdDisplay"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"font-mono text-xs bg-gray-100 p-1 rounded"</span><span class="s3">&gt;</span><span class="s4">In attesa...</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Sezione Promemoria Giornalieri (Da Ripassare Oggi) --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"card bg-white p-6 rounded-xl mb-8 border-4 border-indigo-200"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-semibold mb-4 text-red-600 flex items-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">svg</span><span class="s4"> </span><span class="s2">xmlns</span><span class="s3">=</span><span class="s1">"http://www.w3.org/2000/svg"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"h-6 w-6 mr-2"</span><span class="s4"> </span><span class="s2">fill</span><span class="s3">=</span><span class="s1">"none"</span><span class="s4"> </span><span class="s2">viewBox</span><span class="s3">=</span><span class="s1">"0 0 24 24"</span><span class="s4"> </span><span class="s2">stroke</span><span class="s3">=</span><span class="s1">"currentColor"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                  </span></span><span class="s3">&lt;</span><span class="s6">path</span><span class="s4"> </span><span class="s2">stroke-linecap</span><span class="s3">=</span><span class="s1">"round"</span><span class="s4"> </span><span class="s2">stroke-linejoin</span><span class="s3">=</span><span class="s1">"round"</span><span class="s4"> </span><span class="s2">stroke-width</span><span class="s3">=</span><span class="s1">"2"</span><span class="s4"> </span><span class="s2">d</span><span class="s3">=</span><span class="s1">"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"</span><span class="s4"> </span><span class="s3">/&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">svg</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>Promemoria da Ripassare OGGI</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">ul</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"dailyReviewList"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"space-y-3"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">&lt;!-- I promemoria da ripassare OGGI verranno inseriti qui --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">ul</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"emptyDailyMessage"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-center text-gray-500 py-4 hidden"</span><span class="s3">&gt;</span><span class="s1">Nessun promemoria da ripassare oggi. Ottimo lavoro!</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Sezione Lista Tutti i Promemoria --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"card bg-white p-6 rounded-xl"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-semibold mb-4 text-indigo-600"</span><span class="s3">&gt;</span><span class="s4">Tutti i Promemoria Salvati</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"loadingIndicator"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex justify-center py-4 hidden"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-8 w-8"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">ul</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"memosList"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"space-y-3"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">&lt;!-- Tutti i promemoria verranno inseriti qui dal JS --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">ul</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"emptyMessage"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-center text-gray-500 py-4 hidden"</span><span class="s3">&gt;</span><span class="s1">Non ci sono promemoria. Aggiungine uno per iniziare!</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Modale per la conferma --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"modal"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-3 text-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg leading-6 font-medium text-gray-900"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"modalTitle"</span><span class="s3">&gt;</span><span class="s4">Conferma Eliminazione</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"mt-2 px-7 py-3"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm text-gray-500"</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"modalMessage"</span><span class="s3">&gt;</span><span class="s1">Sei sicuro di voler eliminare questo promemoria?</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"items-center px-4 py-3"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"confirmBtn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md w-24 shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 mr-2"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>Elimina</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"cancelBtn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md w-24 shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>Annulla</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s10">import</span><span class="s4"> { initializeApp } </span><span class="s10">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">import</span><span class="s1"> { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence } </span><span class="s10">from</span><span class="s1"> </span><span class="s7">"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">import</span><span class="s1"> { getFirestore, doc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, addDoc, serverTimestamp, setLogLevel, getDoc } </span><span class="s10">from</span><span class="s1"> </span><span class="s7">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Variabili Globali</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> app = </span><span class="s10">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> db = </span><span class="s10">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> auth = </span><span class="s10">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> userId = </span><span class="s10">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> appId = </span><span class="s10">null</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Sequenza degli intervalli di ripasso (in giorni): 1, 3, 7, 14, 30, 90, 180, ...</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> </span><span class="s11">REVIEW_INTERVALS</span><span class="s1"> = [</span><span class="s12">1</span><span class="s1">, </span><span class="s12">3</span><span class="s1">, </span><span class="s12">7</span><span class="s1">, </span><span class="s12">14</span><span class="s1">, </span><span class="s12">30</span><span class="s1">, </span><span class="s12">90</span><span class="s1">, </span><span class="s12">180</span><span class="s1">, </span><span class="s12">365</span><span class="s1">];</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Utility per le Date ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> getTodayTimestamp() {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Restituisce l'inizio del giorno di oggi come timestamp Firestore (per il confronto)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> now = </span><span class="s10">new</span><span class="s1"> </span><span class="s11">Date</span><span class="s1">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>now.setHours(</span><span class="s12">0</span><span class="s1">, </span><span class="s12">0</span><span class="s1">, </span><span class="s12">0</span><span class="s1">, </span><span class="s12">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> now.getTime();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> formatDate(date) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (!date) </span><span class="s10">return</span><span class="s1"> </span><span class="s7">'N/A'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> d = date </span><span class="s10">instanceof</span><span class="s1"> </span><span class="s11">Date</span><span class="s1"> ? date : date.toDate();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> d.toLocaleDateString(</span><span class="s7">'it-IT'</span><span class="s1">, { year: </span><span class="s7">'numeric'</span><span class="s1">, month: </span><span class="s7">'short'</span><span class="s1">, day: </span><span class="s7">'numeric'</span><span class="s1"> });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> calculateNextDate(currentInterval) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> nextIntervalIndex = </span><span class="s11">REVIEW_INTERVALS</span><span class="s1">.indexOf(currentInterval);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> newInterval = currentInterval;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (nextIntervalIndex !== -</span><span class="s12">1</span><span class="s1"> &amp;&amp; nextIntervalIndex &lt; </span><span class="s11">REVIEW_INTERVALS</span><span class="s1">.length - </span><span class="s12">1</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>newInterval = </span><span class="s11">REVIEW_INTERVALS</span><span class="s1">[nextIntervalIndex + </span><span class="s12">1</span><span class="s1">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (nextIntervalIndex === </span><span class="s11">REVIEW_INTERVALS</span><span class="s1">.length - </span><span class="s12">1</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Se è l'ultimo intervallo, lo manteniamo o aumentiamo leggermente</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>newInterval = currentInterval * </span><span class="s12">2</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (currentInterval === </span><span class="s12">0</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Stato iniziale o ripasso forzato</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>newInterval = </span><span class="s11">REVIEW_INTERVALS</span><span class="s1">[</span><span class="s12">0</span><span class="s1">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> nextDate = </span><span class="s10">new</span><span class="s1"> </span><span class="s11">Date</span><span class="s1">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>nextDate.setDate(nextDate.getDate() + newInterval);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Ritorna la prossima data e il nuovo intervallo</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> { nextDate: nextDate, newInterval: newInterval };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Gestione Configurazione e Inizializzazione Firebase ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> getFirebaseConfig() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> (</span><span class="s10">typeof</span><span class="s1"> __firebase_config !== </span><span class="s7">'undefined'</span><span class="s1"> &amp;&amp; __firebase_config) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> config = </span><span class="s11">JSON</span><span class="s1">.parse(__firebase_config);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.warn(</span><span class="s7">'Configurazione Firebase utilizzata:'</span><span class="s1">, config);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">return</span><span class="s1"> config;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s1">"Variabile __firebase_config non definita o vuota."</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">return</span><span class="s1"> { apiKey: </span><span class="s7">"FALLBACK_API_KEY"</span><span class="s1">, projectId: </span><span class="s7">"fallback-project"</span><span class="s1"> };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">catch</span><span class="s1"> (error) {</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                </span>console.error(</span><span class="s1">"Errore nel parsing di __firebase_config:"</span><span class="s4">, error);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1"> { apiKey: </span><span class="s7">"FALLBACK_API_KEY"</span><span class="s1">, projectId: </span><span class="s7">"fallback-project"</span><span class="s1"> };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> startApplicationLogic() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>setLogLevel(</span><span class="s7">'error'</span><span class="s1">);<span class="Apple-converted-space"> </span></span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>appId = </span><span class="s10">typeof</span><span class="s1"> __app_id !== </span><span class="s7">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s7">'default-app-id'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> firebaseConfig = getFirebaseConfig();</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>app = initializeApp(firebaseConfig);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>db = getFirestore(app);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>auth = getAuth(app);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>onAuthStateChanged(auth, </span><span class="s10">async</span><span class="s1"> (user) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> (user) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>userId = user.uid;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>document.getElementById(</span><span class="s7">'userIdDisplay'</span><span class="s1">).textContent = userId;</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                        </span>console.log(</span><span class="s1">`Firebase e Autenticazione completate. UserID: </span><span class="s4">${userId}</span><span class="s1">`</span><span class="s4">);</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>setupEventListeners();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>setupMemosListener();</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">if</span><span class="s1"> (</span><span class="s10">typeof</span><span class="s1"> __initial_auth_token !== </span><span class="s7">'undefined'</span><span class="s1"> &amp;&amp; __initial_auth_token) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">await</span><span class="s1"> signInWithCustomToken(auth, __initial_auth_token);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">await</span><span class="s1"> setPersistence(auth, browserSessionPersistence);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">await</span><span class="s1"> signInAnonymously(auth);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">catch</span><span class="s1"> (error) {</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                </span>console.error(</span><span class="s1">"Errore nell'inizializzazione di Firebase o nell'autenticazione:"</span><span class="s4">, error);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.getElementById(</span><span class="s7">'userIdDisplay'</span><span class="s1">).textContent = </span><span class="s7">'ERRORE: Vedi console'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Funzioni Helper Firebase ---</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> getCollectionPath(collectionName) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Path per dati privati (userId è l'identificatore)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> </span><span class="s7">`/artifacts/</span><span class="s1">${appId}</span><span class="s7">/users/</span><span class="s1">${userId}</span><span class="s7">/</span><span class="s1">${collectionName}</span><span class="s7">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Path specifico per i metadati/dati dei file</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> getFilePath(fileName) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> </span><span class="s7">`/artifacts/</span><span class="s1">${appId}</span><span class="s7">/users/</span><span class="s1">${userId}</span><span class="s7">/files/</span><span class="s1">${fileName}</span><span class="s7">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Logica Promemoria (CRUD) - Funzione Unificata ---</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> uploadFileAndCreateMemo() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> fileInput = document.getElementById(</span><span class="s7">'fileInput'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> memoNameInput = document.getElementById(</span><span class="s7">'memoNameInput'</span><span class="s1">);<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> messageDiv = document.getElementById(</span><span class="s7">'fileUploadMessage'</span><span class="s1">);</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> file = fileInput.files[</span><span class="s12">0</span><span class="s1">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> memoName = memoNameInput.value.trim();</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (!file) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.textContent = </span><span class="s7">"Seleziona un file da caricare."</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (!memoName) {</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                </span>messageDiv.textContent = </span><span class="s1">"Assegna un nome al promemoria prima di caricare."</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (file.size &gt; </span><span class="s12">1024</span><span class="s1"> * </span><span class="s12">1024</span><span class="s1">) { </span><span class="s13">// 1MB</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.textContent = </span><span class="s7">"Il file è troppo grande (Max 1MB)."</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (!userId) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.textContent = </span><span class="s7">"Errore di autenticazione. Riprova."</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Disabilita pulsante e mostra caricamento</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s7">'uploadFileButton'</span><span class="s1">).disabled = </span><span class="s10">true</span><span class="s1">;</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>messageDiv.innerHTML = </span><span class="s1">`&lt;span class="flex items-center"&gt;&lt;div class="loader ease-linear rounded-full border-4 border-t-4 border-indigo-400 h-5 w-5 mr-3"&gt;&lt;/div&gt; Caricamento in corso...&lt;/span&gt;`</span><span class="s4">;</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>messageDiv.className = </span><span class="s1">'mt-3 text-sm font-medium text-indigo-700'</span><span class="s4">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Leggere il file come Base64</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> reader = </span><span class="s10">new</span><span class="s1"> </span><span class="s11">FileReader</span><span class="s1">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>reader.onload = </span><span class="s10">async</span><span class="s1"> (e) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> base64Data = e.target.result.split(</span><span class="s7">','</span><span class="s1">)[</span><span class="s12">1</span><span class="s1">];</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Creare un documento file unico</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> fileUniqueId = </span><span class="s7">`file_</span><span class="s1">${</span><span class="s11">Date</span><span class="s1">.now()}</span><span class="s7">_</span><span class="s1">${</span><span class="s11">Math</span><span class="s1">.random().toString(</span><span class="s12">36</span><span class="s1">).substring(</span><span class="s12">2</span><span class="s1">, </span><span class="s12">9</span><span class="s1">)}</span><span class="s7">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> fileDocRef = doc(db, getFilePath(fileUniqueId));</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> fileMetadata = {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>name: file.name,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>mimeType: file.type,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>size: file.size,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>timestamp: serverTimestamp(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>data: base64Data<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>};</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Calcolo prima data di ripasso (oggi o domani, per il primo ripasso)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> initialReviewData = calculateNextDate(</span><span class="s12">0</span><span class="s1">); </span><span class="s13">// Inizia con intervallo 0</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">try</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// 1. Salva il file nel suo percorso (Base64)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">await</span><span class="s1"> setDoc(fileDocRef, fileMetadata);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// 2. Crea un promemoria con i dati SRS</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> memo = {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span>text: memoName, </span><span class="s1">// Usa il nome fornito dall'utente come testo principale</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>timestamp: serverTimestamp(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>file: {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>id: fileDocRef.id,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>originalName: file.name,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>mimeType: file.type,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>sizeKB: (file.size / </span><span class="s12">1024</span><span class="s1">).toFixed(</span><span class="s12">1</span><span class="s1">)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>},</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s1">// Dati per il Ripasso Spaziato</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>lastReviewDate: </span><span class="s10">null</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>nextReviewDate: initialReviewData.nextDate,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>reviewIntervalDays: initialReviewData.newInterval </span><span class="s13">// 1 giorno</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> collectionRef = collection(db, getCollectionPath(</span><span class="s7">'memos'</span><span class="s1">));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">await</span><span class="s1"> addDoc(collectionRef, memo);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageDiv.textContent = </span><span class="s7">"File caricato e promemoria SRS creato! Prossimo ripasso: "</span><span class="s1"> + formatDate(initialReviewData.nextDate);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-green-700'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>fileInput.value = </span><span class="s7">''</span><span class="s1">;<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>memoNameInput.value = </span><span class="s7">''</span><span class="s1">;<span class="Apple-converted-space"> </span></span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s10">catch</span><span class="s1"> (e) {</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s1">"Errore durante il salvataggio del file/promemoria: "</span><span class="s4">, e);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                    </span>messageDiv.textContent = </span><span class="s1">"Errore nel salvataggio. Il file potrebbe essere troppo grande o esserci problemi di rete."</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s10">finally</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>document.getElementById(</span><span class="s7">'uploadFileButton'</span><span class="s1">).disabled = </span><span class="s10">false</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>reader.onerror = () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.textContent = </span><span class="s7">"Errore nella lettura del file."</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.getElementById(</span><span class="s7">'uploadFileButton'</span><span class="s1">).disabled = </span><span class="s10">false</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>reader.readAsDataURL(file);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> markAsReviewed(memoId, currentInterval) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s10">const</span><span class="s1"> messageDiv = document.getElementById(</span><span class="s7">'fileUploadMessage'</span><span class="s1">);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">             </span>messageDiv.textContent = </span><span class="s1">"Aggiornamento intervallo di ripasso..."</span><span class="s4">;</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">             </span>messageDiv.className = </span><span class="s1">'mt-3 text-sm font-medium text-indigo-500'</span><span class="s4">;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> { nextDate, newInterval } = calculateNextDate(currentInterval);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> memoRef = doc(db, getCollectionPath(</span><span class="s7">'memos'</span><span class="s1">), memoId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">await</span><span class="s1"> updateDoc(memoRef, {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>lastReviewDate: </span><span class="s10">new</span><span class="s1"> </span><span class="s11">Date</span><span class="s1">(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>nextReviewDate: nextDate,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>reviewIntervalDays: newInterval</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.textContent = </span><span class="s7">`Ripasso salvato! Prossimo ripasso tra </span><span class="s1">${newInterval}</span><span class="s7"> giorni (</span><span class="s1">${formatDate(nextDate)}</span><span class="s7">).`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-green-700'</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">catch</span><span class="s1"> (e) {</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                </span>console.error(</span><span class="s1">"Errore nell'aggiornamento del ripasso: "</span><span class="s4">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.textContent = </span><span class="s7">`Errore: Impossibile salvare il ripasso. </span><span class="s1">${e.message}</span><span class="s7">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> deleteMemo(id) {</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>showModal(</span><span class="s1">"Conferma Eliminazione"</span><span class="s4">, </span><span class="s1">"Sei sicuro di voler eliminare questo promemoria?"</span><span class="s4">, </span><span class="s10">async</span><span class="s4"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> memoRef = doc(db, getCollectionPath(</span><span class="s7">'memos'</span><span class="s1">), id);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">await</span><span class="s1"> deleteDoc(memoRef);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                    </span>console.log(</span><span class="s1">"Promemoria eliminato con successo."</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s10">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s7">"Errore nell'eliminare il promemoria: "</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Ascolto Dati in Tempo Reale (onSnapshot) ---</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> setupMemosListener() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> loading = document.getElementById(</span><span class="s7">'loadingIndicator'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>loading.classList.remove(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> q = query(collection(db, getCollectionPath(</span><span class="s7">'memos'</span><span class="s1">)));</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot(q, (snapshot) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>loading.classList.add(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> allMemos = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>snapshot.forEach((doc) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>allMemos.push({ id: doc.id, ...doc.data() });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Ordina per data di ripasso (dal più urgente al meno urgente)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>allMemos.sort((a, b) =&gt; (a.nextReviewDate?.toDate().getTime() || </span><span class="s11">Infinity</span><span class="s1">) - (b.nextReviewDate?.toDate().getTime() || </span><span class="s11">Infinity</span><span class="s1">));</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>renderMemos(allMemos);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}, (error) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>loading.classList.add(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.error(</span><span class="s7">"Errore nell'ascolto dei promemoria:"</span><span class="s1">, error);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Render UI ---</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> renderMemos(memos) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> listElement = document.getElementById(</span><span class="s7">'memosList'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> dailyListElement = document.getElementById(</span><span class="s7">'dailyReviewList'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> emptyAll = document.getElementById(</span><span class="s7">'emptyMessage'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> emptyDaily = document.getElementById(</span><span class="s7">'emptyDailyMessage'</span><span class="s1">);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>listElement.innerHTML = </span><span class="s7">''</span><span class="s1">;<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>dailyListElement.innerHTML = </span><span class="s7">''</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> today = getTodayTimestamp();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> dailyMemos = [];</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>memos.forEach(memo =&gt; {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Aggiungiamo i dati di ripasso al promemoria</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> nextReviewTimestamp = memo.nextReviewDate?.toDate().getTime() || </span><span class="s12">0</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 1. Check per Promemoria Giornalieri</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> (nextReviewTimestamp &lt;= today) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>dailyMemos.push(memo);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 2. Render di TUTTI i promemoria</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> li = createMemoListItem(memo, nextReviewTimestamp &lt;= today);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>listElement.appendChild(li);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// 3. Render dei Promemoria Giornalieri</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>dailyMemos.forEach(memo =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> li = createMemoListItem(memo, </span><span class="s10">true</span><span class="s1">); </span><span class="s13">// Passiamo 'true' per indicare che è da ripassare</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>dailyListElement.appendChild(li);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>emptyAll.classList.toggle(</span><span class="s7">'hidden'</span><span class="s1">, memos.length &gt; </span><span class="s12">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>emptyDaily.classList.toggle(</span><span class="s7">'hidden'</span><span class="s1">, dailyMemos.length &gt; </span><span class="s12">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> createMemoListItem(memo, isDue) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> li = document.createElement(</span><span class="s7">'li'</span><span class="s1">);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>li.className = </span><span class="s1">`flex flex-col md:flex-row items-start md:items-center justify-between p-4 border rounded-lg transition duration-150 </span><span class="s4">${isDue ? </span><span class="s1">'bg-red-50 border-red-300 hover:bg-red-100'</span><span class="s4"> : </span><span class="s1">'bg-gray-50 border-gray-200 hover:bg-gray-100'</span><span class="s4">}</span><span class="s1">`</span><span class="s4">;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> content = document.createElement(</span><span class="s7">'div'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>content.className = </span><span class="s7">'flex-1 min-w-0 mb-3 md:mb-0'</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> memoText = document.createElement(</span><span class="s7">'p'</span><span class="s1">);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>memoText.className = </span><span class="s1">'text-gray-800 font-bold break-words'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>memoText.textContent = memo.text;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>content.appendChild(memoText);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> reviewStatus = document.createElement(</span><span class="s7">'p'</span><span class="s1">);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>reviewStatus.className = </span><span class="s1">`text-xs mt-1 font-medium </span><span class="s4">${isDue ? </span><span class="s1">'text-red-600'</span><span class="s4"> : </span><span class="s1">'text-indigo-600'</span><span class="s4">}</span><span class="s1">`</span><span class="s4">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> nextReviewDate = memo.nextReviewDate ? formatDate(memo.nextReviewDate) : </span><span class="s7">'N/A'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> lastReviewDate = memo.lastReviewDate ? formatDate(memo.lastReviewDate) : </span><span class="s7">'Mai'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> interval = memo.reviewIntervalDays || </span><span class="s12">0</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (isDue) {</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                 </span>reviewStatus.innerHTML = </span><span class="s1">`⚠️ &lt;span class="font-extrabold"&gt;RIPASSA OGGI!&lt;/span&gt; | Intervallo attuale: </span><span class="s4">${interval}</span><span class="s1"> gg`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>reviewStatus.innerHTML = </span><span class="s7">`Prossimo Ripasso: &lt;span class="font-bold"&gt;</span><span class="s1">${nextReviewDate}</span><span class="s7">&lt;/span&gt; (in </span><span class="s1">${interval}</span><span class="s7"> gg)`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>content.appendChild(reviewStatus);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (memo.file &amp;&amp; memo.file.id) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> fileInfo = document.createElement(</span><span class="s7">'p'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>fileInfo.className = </span><span class="s7">'text-xs text-gray-500 mt-1'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>fileInfo.textContent = </span><span class="s7">`File: </span><span class="s1">${memo.file.originalName}</span><span class="s7"> (</span><span class="s1">${memo.file.sizeKB}</span><span class="s7"> KB)`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>content.appendChild(fileInfo);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> actions = document.createElement(</span><span class="s7">'div'</span><span class="s1">);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>actions.className = </span><span class="s1">'flex flex-row space-x-2 md:ml-4 flex-shrink-0'</span><span class="s4">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (memo.file &amp;&amp; memo.file.id) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> fileLink = document.createElement(</span><span class="s7">'button'</span><span class="s1">);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                </span>fileLink.className = </span><span class="s1">'btn-secondary text-xs px-3 py-2 font-semibold rounded-lg inline-flex items-center'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>fileLink.onclick = () =&gt; openFile(memo.file.id);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                </span>fileLink.innerHTML = </span><span class="s1">`&lt;svg class="file-icon text-indigo-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"&gt;&lt;path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"&gt;&lt;/path&gt;&lt;polyline points="14 2 14 8 20 8"&gt;&lt;/polyline&gt;&lt;/svg&gt;Apri`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>actions.appendChild(fileLink);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Pulsante "Ho Ripassato"</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> reviewButton = document.createElement(</span><span class="s7">'button'</span><span class="s1">);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>reviewButton.className = </span><span class="s1">'btn-review text-xs px-3 py-2 font-semibold rounded-lg shadow-md'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>reviewButton.textContent = </span><span class="s7">'Ho Ripassato!'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>reviewButton.onclick = () =&gt; markAsReviewed(memo.id, memo.reviewIntervalDays);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>actions.appendChild(reviewButton);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> deleteButton = document.createElement(</span><span class="s7">'button'</span><span class="s1">);</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>deleteButton.className = </span><span class="s1">'text-red-500 hover:text-red-700 p-2 rounded-full transition duration-150'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>deleteButton.innerHTML = </span><span class="s7">`</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/svg&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>deleteButton.onclick = () =&gt; deleteMemo(memo.id);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>actions.appendChild(deleteButton);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>li.appendChild(content);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>li.appendChild(actions);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> li;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Logica Apertura File ---</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> openFile(fileDocId) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> messageDiv = document.getElementById(</span><span class="s7">'fileUploadMessage'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>messageDiv.textContent = </span><span class="s7">"Recupero file in corso..."</span><span class="s1">;</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">            </span>messageDiv.className = </span><span class="s1">'mt-3 text-sm font-medium text-indigo-500'</span><span class="s4">;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> fileRef = doc(db, getFilePath(fileDocId));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> fileSnapshot = </span><span class="s10">await</span><span class="s1"> getDoc(fileRef);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> (fileSnapshot.exists()) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> fileData = fileSnapshot.data();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> base64Data = fileData.data;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> mimeType = fileData.mimeType;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> fileName = fileData.name;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> (!base64Data || !mimeType) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>messageDiv.textContent = </span><span class="s7">"Errore: Dati file mancanti."</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> url = </span><span class="s7">`data:</span><span class="s1">${mimeType}</span><span class="s7">;base64,</span><span class="s1">${base64Data}</span><span class="s7">`</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> newTab = window.open(url, </span><span class="s7">'_blank'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> (newTab) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>newTab.document.title = fileName;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p11"><span class="s4"><span class="Apple-converted-space">                        </span>messageDiv.textContent = </span><span class="s1">"Impossibile aprire il file. Controlla il blocco pop-up."</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageDiv.textContent = </span><span class="s7">`File "</span><span class="s1">${fileName}</span><span class="s7">" aperto con successo.`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-green-700'</span><span class="s1">;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageDiv.textContent = </span><span class="s7">"Errore: File non trovato nel database."</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.error(</span><span class="s7">"Errore nel recupero del file:"</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.textContent = </span><span class="s7">`Errore nel recupero del file: </span><span class="s1">${e.message}</span><span class="s7">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageDiv.className = </span><span class="s7">'mt-3 text-sm font-bold text-red-600'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Logica Modale ---</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> modalCallback = </span><span class="s10">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> modal = document.getElementById(</span><span class="s7">'modal'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> confirmBtn = document.getElementById(</span><span class="s7">'confirmBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> cancelBtn = document.getElementById(</span><span class="s7">'cancelBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> modalTitle = document.getElementById(</span><span class="s7">'modalTitle'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> modalMessage = document.getElementById(</span><span class="s7">'modalMessage'</span><span class="s1">);</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> showModal(title, message, callback) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>modalTitle.textContent = title;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>modalMessage.textContent = message;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>modalCallback = callback;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>modal.classList.remove(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> hideModal() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>modal.classList.add(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>modalCallback = </span><span class="s10">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>confirmBtn.onclick = () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (modalCallback) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>modalCallback();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>hideModal();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>cancelBtn.onclick = hideModal;</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>modal.onclick = (event) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (event.target === modal) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>hideModal();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Setup Event Listeners ---</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> setupEventListeners() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById(</span><span class="s7">'uploadFileButton'</span><span class="s1">).addEventListener(</span><span class="s7">'click'</span><span class="s1">, uploadFileAndCreateMemo);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Avvio App ---</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>document.addEventListener(</span><span class="s7">'DOMContentLoaded'</span><span class="s1">, startApplicationLogic);</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p10"><span class="s1"></span><br></p>
</body>
</html>
