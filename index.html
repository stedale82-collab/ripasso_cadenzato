<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.1">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #36c0a0; -webkit-text-stroke: #36c0a0}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s7 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s8 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s9 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s10 {font-kerning: none; color: #6d7378; background-color: #171818; -webkit-text-stroke: 0px #6d7378}
    span.s11 {font-kerning: none}
    span.s12 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s13 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
    span.s14 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s15 {font-kerning: none; color: #a34f83; background-color: #171818; -webkit-text-stroke: 0px #a34f83}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!--<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1">ATTENZIONE:<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1">Questo file è pronto per l'hosting su GitHub Pages.<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1">I VALORI DI FIREBASE SONO STATI INSERITI SECONDO I DATI FORNITI DALL'UTENTE.</span></p>
<p class="p1"><span class="s1">--&gt;</span></p>
<p class="p2"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"it"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">Promemoria a Ripetizione Spaziata</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap"</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s8">'Inter'</span><span class="s7">,</span><span class="s1"> </span><span class="s5">sans-serif</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #f7f9fc</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.card</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #ffffff</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">1px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #e2e8f0</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">4px</span><span class="s1"> </span><span class="s9">6px</span><span class="s1"> </span><span class="s5">rgba(</span><span class="s9">0</span><span class="s7">,</span><span class="s1"> </span><span class="s9">0</span><span class="s7">,</span><span class="s1"> </span><span class="s9">0</span><span class="s7">,</span><span class="s1"> </span><span class="s9">0.05</span><span class="s5">)</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s1"> </span><span class="s5">transform</span><span class="s1"> </span><span class="s9">0.2s</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.review-due</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">border-left:</span><span class="s4"> </span><span class="s9">5px</span><span class="s4"> </span><span class="s5">solid</span><span class="s4"> #ef4444</span><span class="s7">;</span><span class="s4"> </span><span class="s1">/* Rosso per l'urgenza */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.review-soon</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">border-left:</span><span class="s4"> </span><span class="s9">5px</span><span class="s4"> </span><span class="s5">solid</span><span class="s4"> #E1AD01</span><span class="s7">;</span><span class="s4"> </span><span class="s1">/* Giallo Ocra per l'attesa */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.review-ok</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">border-left:</span><span class="s4"> </span><span class="s9">5px</span><span class="s4"> </span><span class="s5">solid</span><span class="s4"> #10b981</span><span class="s7">;</span><span class="s4"> </span><span class="s1">/* Verde per l'aggiornato */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Stili per il pulsante primario generico (non Add Memo) */</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-primary</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #4f46e5</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s5">white</span><span class="s7">;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-primary:hover</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #4338ca</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Stili per il pulsante giallo richiesta dall'utente (Add Memo) */</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-add-memo</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #ffc107</span><span class="s7">;</span><span class="s1"> </span><span class="s10">/* Giallo standard */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> #000000</span><span class="s7">;</span><span class="s1"> </span><span class="s10">/* Scritta nera */</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-add-memo:hover</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s4"> #e0a800</span><span class="s7">;</span><span class="s4"> </span><span class="s1">/* Giallo più scuro per l'hover */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Stili per il pulsante di ripasso */</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-review</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #22c55e</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s5">white</span><span class="s7">;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-review:hover</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #16a34a</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 md:p-8 min-h-screen"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Loader --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"loader"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fixed inset-0 bg-gray-100 bg-opacity-75 flex items-center justify-center z-50 hidden"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"max-w-4xl mx-auto"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-3xl font-bold text-gray-900 mb-6 text-center"</span><span class="s3">&gt;</span><span class="s4">Curva dell'Oblio: Promemoria Spaziati</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-center text-gray-600 mb-8"</span><span class="s3">&gt;</span><span class="s1">Il tuo sistema personale per contrastare l'oblio. I promemoria appariranno qui quando sarà il momento di ripassarli.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Form per l'aggiunta di un nuovo promemoria o file --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"card p-6 rounded-xl mb-8"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xl font-semibold text-gray-700 mb-4"</span><span class="s3">&gt;</span><span class="s1">Aggiungi un Nuovo Promemoria o Carica File (TXT, PDF, JPG)</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"space-y-4"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">&lt;!-- Nuovo campo per il caricamento file --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"file"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"fileInput"</span><span class="s4"> </span><span class="s2">accept</span><span class="s3">=</span><span class="s1">".txt, text/plain, .pdf, application/pdf, .jpeg, .jpg, image/jpeg"</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                       </span></span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-gray-700 bg-gray-50"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"fileStatus"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm text-gray-600 italic hidden"</span><span class="s3">&gt;</span><span class="s1">Contenuto file caricato e pronto per essere salvato come promemoria.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Placeholder aggiornato per riflettere che è opzionale con file --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"memoInput"</span><span class="s4"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"Cosa devi ricordare? (Opzionale, se alleghi un file)"</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                           </span></span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-grow p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Pulsante Add Memo con il nuovo stile giallo/nero --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"addMemoBtn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn-add-memo py-3 px-6 rounded-lg text-lg font-medium shadow-md hover:shadow-lg"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>Aggiungi Promemoria</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Lista dei promemoria --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-gray-800 mb-4"</span><span class="s3">&gt;</span><span class="s4">I tuoi Promemoria</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"memosList"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"space-y-4"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- I promemoria verranno inseriti qui da JavaScript --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"loadingStatus"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-center text-gray-500"</span><span class="s3">&gt;</span><span class="s1">Caricamento dei promemoria...</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Messaggio Modale (al posto di alert) --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"modal"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"modalTitle"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-bold mb-3 text-gray-900"</span><span class="s3">&gt;&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"modalMessage"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-gray-700 mb-4"</span><span class="s3">&gt;&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"document.getElementById('modal').classList.add('hidden')"</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn-primary py-2 px-4 rounded-lg font-medium w-full"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>Chiudi</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Firebase Imports --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">import</span><span class="s4"> </span><span class="s7">{</span><span class="s4"> initializeApp </span><span class="s7">}</span><span class="s4"> </span><span class="s12">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">import</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> getAuth</span><span class="s7">,</span><span class="s1"> signInAnonymously</span><span class="s7">,</span><span class="s1"> signInWithCustomToken </span><span class="s7">}</span><span class="s1"> </span><span class="s12">from</span><span class="s1"> </span><span class="s8">"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">import</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> getFirestore</span><span class="s7">,</span><span class="s1"> doc</span><span class="s7">,</span><span class="s1"> collection</span><span class="s7">,</span><span class="s1"> onSnapshot</span><span class="s7">,</span><span class="s1"> addDoc</span><span class="s7">,</span><span class="s1"> updateDoc</span><span class="s7">,</span><span class="s1"> deleteDoc </span><span class="s7">}</span><span class="s1"> </span><span class="s12">from</span><span class="s1"> </span><span class="s8">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s7">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">import</span><span class="s4"> </span><span class="s7">{</span><span class="s4"> setLogLevel </span><span class="s7">}</span><span class="s4"> </span><span class="s12">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// setLogLevel('debug'); // Abilita i log di debug di Firestore</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// =========================================================================</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// === PASSO 1: CONFIGURAZIONE FIREBASE REALE (INSERITA DALL'UTENTE) ===</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// =========================================================================</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Questo sarà il tuo ID statico. Usalo come prefisso nei percorsi Firestore.</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s4"> appId </span><span class="s7">=</span><span class="s4"> </span><span class="s1">'curva-oblio-personale'</span><span class="s7">;</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// La configurazione che trovi sulla console Firebase per la tua app web.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s1"> firebaseConfig </span><span class="s7">=</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// CHIAVE API COMPLETA INSERITA DALLO SCREENSHOT:</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span>apiKey</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"AIzaSyBd8889yJg1eY3h0K5h0d1O1pQ1c4o_CXG"</span><span class="s7">,</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span>authDomain</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"ripasso-cadenzato.firebaseapp.com"</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>projectId</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"ripasso-cadenzato"</span><span class="s7">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span>storageBucket</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"ripasso-cadenzato.appspot.com"</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>messagingSenderId</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"102819895913"</span><span class="s7">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span>appId</span><span class="s7">:</span><span class="s4"> </span><span class="s1">"1:102819895913:web:6e3ec0be2b0e2d6f387a38"</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Non usiamo più il token dinamico in un ambiente esterno.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s1"> initialAuthToken </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// =========================================================================</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// =========================================================================</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> db</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> auth</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> userId </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'loading'</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> loaderElement</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> loadingStatusElement</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Stato della notifica</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> notificationPermission </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'default'</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Variabili globali per i dati del file caricato (da salvare nel promemoria)</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s4"> uploadedFileBase64 </span><span class="s7">=</span><span class="s4"> </span><span class="s12">null</span><span class="s7">;</span><span class="s4"> </span><span class="s1">// Dati Base64 del file originale</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> uploadedFileMimeType </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span><span class="s1"> </span><span class="s10">// Tipo MIME del file originale</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// LIMITE DIMENSIONE FILE AGGIORNATO A 300 KB</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s4"> </span><span class="s1">MAX_FILE_SIZE_KB</span><span class="s4"> </span><span class="s7">=</span><span class="s4"> </span><span class="s13">300</span><span class="s7">;</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Mantiene una copia locale dei promemoria per accedere ai dati Base64</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> currentMemosList </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[];</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Funzioni di Utilità ---</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Funzione per convertire il file in Base64<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> readFileAsBase64</span><span class="s7">(</span><span class="s1">file</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">return</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Promise</span><span class="s7">((</span><span class="s1">resolve</span><span class="s7">,</span><span class="s1"> reject</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> reader </span><span class="s7">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">FileReader</span><span class="s7">();</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// readAsDataURL include il mime type, es: "data:image/jpeg;base64,..."</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Risolve con la parte dei dati (dopo la virgola)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>reader</span><span class="s7">.</span><span class="s1">onload </span><span class="s7">=</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> resolve</span><span class="s7">(</span><span class="s1">reader</span><span class="s7">.</span><span class="s1">result</span><span class="s7">.</span><span class="s1">split</span><span class="s7">(</span><span class="s8">','</span><span class="s7">)[</span><span class="s13">1</span><span class="s7">]);</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>reader</span><span class="s7">.</span><span class="s1">onerror </span><span class="s7">=</span><span class="s1"> error </span><span class="s7">=&gt;</span><span class="s1"> reject</span><span class="s7">(</span><span class="s1">error</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>reader</span><span class="s7">.</span><span class="s1">readAsDataURL</span><span class="s7">(</span><span class="s1">file</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Funzione per ricostruire il file Base64 e aprirlo in una nuova scheda</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> openFileInNewTab</span><span class="s7">(</span><span class="s1">base64</span><span class="s7">,</span><span class="s1"> mimeType</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Decodifica la stringa Base64 in byte</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> byteCharacters </span><span class="s7">=</span><span class="s1"> atob</span><span class="s7">(</span><span class="s1">base64</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> byteNumbers </span><span class="s7">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Array</span><span class="s7">(</span><span class="s1">byteCharacters</span><span class="s7">.</span><span class="s1">length</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">for</span><span class="s1"> </span><span class="s7">(</span><span class="s12">let</span><span class="s1"> i </span><span class="s7">=</span><span class="s1"> </span><span class="s13">0</span><span class="s7">;</span><span class="s1"> i </span><span class="s7">&lt;</span><span class="s1"> byteCharacters</span><span class="s7">.</span><span class="s1">length</span><span class="s7">;</span><span class="s1"> i</span><span class="s7">++)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>byteNumbers</span><span class="s7">[</span><span class="s1">i</span><span class="s7">]</span><span class="s1"> </span><span class="s7">=</span><span class="s1"> byteCharacters</span><span class="s7">.</span><span class="s1">charCodeAt</span><span class="s7">(</span><span class="s1">i</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> byteArray </span><span class="s7">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Uint8Array</span><span class="s7">(</span><span class="s1">byteNumbers</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Crea un Blob (oggetto file)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> blob </span><span class="s7">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Blob</span><span class="s7">([</span><span class="s1">byteArray</span><span class="s7">],</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> type</span><span class="s7">:</span><span class="s1"> mimeType </span><span class="s7">});</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Crea un URL locale per il Blob</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> blobUrl </span><span class="s7">=</span><span class="s1"> </span><span class="s14">URL</span><span class="s7">.</span><span class="s1">createObjectURL</span><span class="s7">(</span><span class="s1">blob</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Apri in una nuova finestra/tab</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>window</span><span class="s7">.</span><span class="s1">open</span><span class="s7">(</span><span class="s1">blobUrl</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'_blank'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">"Errore nell'apertura del file Base64:"</span><span class="s7">,</span><span class="s4"> e</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Errore"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"Impossibile aprire il file. Dati Base64 non validi o MIME type sconosciuto."</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Funzioni di Notifica ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> requestNotificationPermission</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(!(</span><span class="s8">"Notification"</span><span class="s1"> </span><span class="s12">in</span><span class="s1"> window</span><span class="s7">))</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s4">warn</span><span class="s7">(</span><span class="s1">"Questo browser non supporta le notifiche desktop."</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">return</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s14">Notification</span><span class="s7">.</span><span class="s1">permission </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'granted'</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> </span><span class="s14">Notification</span><span class="s7">.</span><span class="s1">permission </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'denied'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>notificationPermission </span><span class="s7">=</span><span class="s1"> </span><span class="s14">Notification</span><span class="s7">.</span><span class="s1">permission</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">return</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s14">Notification</span><span class="s7">.</span><span class="s1">requestPermission</span><span class="s7">().</span><span class="s1">then</span><span class="s7">(</span><span class="s1">permission </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>notificationPermission </span><span class="s7">=</span><span class="s1"> permission</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">permission </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'denied'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console</span><span class="s7">.</span><span class="s1">log</span><span class="s7">(</span><span class="s8">"Permesso di notifica negato."</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> sendDueNotification</span><span class="s7">(</span><span class="s1">content</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">notificationPermission </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'granted'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s12">new</span><span class="s4"> </span><span class="s14">Notification</span><span class="s7">(</span><span class="s1">"⏳ Ripasso Imminente!"</span><span class="s7">,</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>body</span><span class="s7">:</span><span class="s1"> </span><span class="s8">`È il momento di rivedere: </span><span class="s7">${</span><span class="s1">content</span><span class="s7">}</span><span class="s8">`</span><span class="s7">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>icon</span><span class="s7">:</span><span class="s4"> </span><span class="s1">'https://placehold.co/64x64/4f46e5/ffffff?text=M'</span><span class="s7">,</span><span class="s4"> </span><span class="s10">// Icona del promemoria (Memo)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>vibrate</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[</span><span class="s13">200</span><span class="s7">,</span><span class="s1"> </span><span class="s13">100</span><span class="s7">,</span><span class="s1"> </span><span class="s13">200</span><span class="s7">]</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Funzione per mostrare il modale (sostituisce alert)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> showModal</span><span class="s7">(</span><span class="s1">title</span><span class="s7">,</span><span class="s1"> message</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'modalTitle'</span><span class="s7">).</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> title</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'modalMessage'</span><span class="s7">).</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> message</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'modal'</span><span class="s7">).</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'modal'</span><span class="s7">).</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'flex'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Funzione per gestire il loader</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> toggleLoader</span><span class="s7">(</span><span class="s1">show</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">loaderElement</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">show</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>loaderElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>loaderElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Intervalli di Ripetizione Spaziata in giorni</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s4"> </span><span class="s1">REPETITION_INTERVALS</span><span class="s4"> </span><span class="s7">=</span><span class="s4"> </span><span class="s7">[</span><span class="s13">1</span><span class="s7">,</span><span class="s4"> </span><span class="s13">3</span><span class="s7">,</span><span class="s4"> </span><span class="s13">7</span><span class="s7">,</span><span class="s4"> </span><span class="s13">15</span><span class="s7">,</span><span class="s4"> </span><span class="s13">30</span><span class="s7">,</span><span class="s4"> </span><span class="s13">90</span><span class="s7">,</span><span class="s4"> </span><span class="s13">180</span><span class="s7">,</span><span class="s4"> </span><span class="s13">365</span><span class="s7">];</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Funzioni di Utilità per la Gestione della Data ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> calculateNextReviewDate</span><span class="s7">(</span><span class="s1">currentIntervalIndex</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> nextInterval </span><span class="s7">=</span><span class="s1"> </span><span class="s14">REPETITION_INTERVALS</span><span class="s7">[</span><span class="s1">currentIntervalIndex</span><span class="s7">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">nextInterval </span><span class="s7">===</span><span class="s1"> </span><span class="s12">undefined</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Se l'indice è troppo alto, l'informazione è consolidata</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">return</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Date</span><span class="s7">(</span><span class="s14">Date</span><span class="s7">.</span><span class="s1">now</span><span class="s7">()</span><span class="s1"> </span><span class="s7">+</span><span class="s1"> </span><span class="s13">365</span><span class="s1"> </span><span class="s7">*</span><span class="s1"> </span><span class="s13">24</span><span class="s1"> </span><span class="s7">*</span><span class="s1"> </span><span class="s13">60</span><span class="s1"> </span><span class="s7">*</span><span class="s1"> </span><span class="s13">60</span><span class="s1"> </span><span class="s7">*</span><span class="s1"> </span><span class="s13">1000</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> nextReview </span><span class="s7">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Date</span><span class="s7">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>nextReview</span><span class="s7">.</span><span class="s1">setDate</span><span class="s7">(</span><span class="s1">nextReview</span><span class="s7">.</span><span class="s1">getDate</span><span class="s7">()</span><span class="s1"> </span><span class="s7">+</span><span class="s1"> nextInterval</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">return</span><span class="s1"> nextReview</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> formatDate</span><span class="s7">(</span><span class="s1">date</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">return</span><span class="s1"> date</span><span class="s7">.</span><span class="s1">toLocaleDateString</span><span class="s7">(</span><span class="s8">'it-IT'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> year</span><span class="s7">:</span><span class="s1"> </span><span class="s8">'numeric'</span><span class="s7">,</span><span class="s1"> month</span><span class="s7">:</span><span class="s1"> </span><span class="s8">'long'</span><span class="s7">,</span><span class="s1"> day</span><span class="s7">:</span><span class="s1"> </span><span class="s8">'numeric'</span><span class="s1"> </span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Funzione Principale per la Gestione dei Promemoria ---</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Funzione per aggiungere un promemoria (AGGIORNATA per file)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">async</span><span class="s1"> </span><span class="s12">function</span><span class="s1"> addMemo</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> input </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'memoInput'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> fileInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'fileInput'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> fileStatusElement </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'fileStatus'</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Il contenuto del promemoria è sempre l'input dell'utente</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">let</span><span class="s1"> content </span><span class="s7">=</span><span class="s1"> input</span><span class="s7">.</span><span class="s1">value</span><span class="s7">.</span><span class="s1">trim</span><span class="s7">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Se c'è un file caricato, ma l'input è vuoto, usa un placeholder</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">uploadedFileBase64 </span><span class="s7">&amp;&amp;</span><span class="s1"> </span><span class="s7">!</span><span class="s1">content</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>content </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`File allegato per ripasso (</span><span class="s7">${</span><span class="s1">uploadedFileMimeType</span><span class="s7">.</span><span class="s1">split</span><span class="s7">(</span><span class="s8">'/'</span><span class="s7">)[</span><span class="s13">1</span><span class="s7">]</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> </span><span class="s8">'sconosciuto'</span><span class="s7">}</span><span class="s8">)`</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">content</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Attenzione"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"Per favore, inserisci un promemoria o carica un file."</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">return</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Tronca il contenuto se troppo lungo per il display (per sicurezza)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">content</span><span class="s7">.</span><span class="s1">length </span><span class="s7">&gt;</span><span class="s1"> </span><span class="s13">500</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>content </span><span class="s7">=</span><span class="s1"> content</span><span class="s7">.</span><span class="s1">substring</span><span class="s7">(</span><span class="s13">0</span><span class="s7">,</span><span class="s1"> </span><span class="s13">500</span><span class="s7">)</span><span class="s1"> </span><span class="s7">+</span><span class="s1"> </span><span class="s8">'...'</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Calcola la prima data di ripasso (intervallo 0 = 1 giorno)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> nextReviewDate </span><span class="s7">=</span><span class="s1"> calculateNextReviewDate</span><span class="s7">(</span><span class="s13">0</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> newMemo </span><span class="s7">=</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>content</span><span class="s7">:</span><span class="s1"> content</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>createdAt</span><span class="s7">:</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Date</span><span class="s7">(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>lastReview</span><span class="s7">:</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Date</span><span class="s7">(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>nextReview</span><span class="s7">:</span><span class="s1"> nextReviewDate</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>intervalIndex</span><span class="s7">:</span><span class="s1"> </span><span class="s13">0</span><span class="s7">,</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Campi del file, se presenti</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>fileBase64</span><span class="s7">:</span><span class="s1"> uploadedFileBase64 </span><span class="s7">||</span><span class="s1"> </span><span class="s12">null</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>fileMimeType</span><span class="s7">:</span><span class="s1"> uploadedFileMimeType </span><span class="s7">||</span><span class="s1"> </span><span class="s12">null</span><span class="s7">,</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Salvataggio nel percorso privato dell'utente</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userId</span><span class="s7">:</span><span class="s1"> userId</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>appId</span><span class="s7">:</span><span class="s1"> appId</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>toggleLoader</span><span class="s7">(</span><span class="s12">true</span><span class="s7">);</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Il percorso Firestore usa l'appId e lo userId definiti in alto</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">await</span><span class="s1"> addDoc</span><span class="s7">(</span><span class="s1">collection</span><span class="s7">(</span><span class="s1">db</span><span class="s7">,</span><span class="s1"> </span><span class="s8">`/artifacts/</span><span class="s7">${</span><span class="s1">appId</span><span class="s7">}</span><span class="s8">/users/</span><span class="s7">${</span><span class="s1">userId</span><span class="s7">}</span><span class="s8">/memos`</span><span class="s7">),</span><span class="s1"> newMemo</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Pulisce dopo l'aggiunta</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>input</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>uploadedFileBase64 </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>uploadedFileMimeType </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>fileInput</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span><span class="s1"> </span><span class="s10">// Resetta input file</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>fileStatusElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>toggleLoader</span><span class="s7">(</span><span class="s12">false</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Successo"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">`Promemoria salvato con successo. Prossimo ripasso: </span><span class="s7">${</span><span class="s4">formatDate</span><span class="s7">(</span><span class="s4">nextReviewDate</span><span class="s7">)}</span><span class="s1">`</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>toggleLoader</span><span class="s7">(</span><span class="s12">false</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">"Errore nell'aggiunta del promemoria:"</span><span class="s7">,</span><span class="s4"> error</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Errore"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"Impossibile salvare il promemoria. Riprova."</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Funzione per aggiornare lo stato di un promemoria dopo il ripasso</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">async</span><span class="s1"> </span><span class="s12">function</span><span class="s1"> reviewMemo</span><span class="s7">(</span><span class="s1">memoId</span><span class="s7">,</span><span class="s1"> currentIntervalIndex</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> nextIntervalIndex </span><span class="s7">=</span><span class="s1"> currentIntervalIndex </span><span class="s7">&lt;</span><span class="s1"> </span><span class="s14">REPETITION_INTERVALS</span><span class="s7">.</span><span class="s1">length </span><span class="s7">-</span><span class="s1"> </span><span class="s13">1</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">?</span><span class="s1"> currentIntervalIndex </span><span class="s7">+</span><span class="s1"> </span><span class="s13">1</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">:</span><span class="s1"> </span><span class="s14">REPETITION_INTERVALS</span><span class="s7">.</span><span class="s1">length </span><span class="s7">-</span><span class="s1"> </span><span class="s13">1</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> nextReviewDate </span><span class="s7">=</span><span class="s1"> calculateNextReviewDate</span><span class="s7">(</span><span class="s1">nextIntervalIndex</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> updatedFields </span><span class="s7">=</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>lastReview</span><span class="s7">:</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Date</span><span class="s7">(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>nextReview</span><span class="s7">:</span><span class="s1"> nextReviewDate</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>intervalIndex</span><span class="s7">:</span><span class="s1"> nextIntervalIndex</span><span class="s7">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>toggleLoader</span><span class="s7">(</span><span class="s12">true</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> memoRef </span><span class="s7">=</span><span class="s1"> doc</span><span class="s7">(</span><span class="s1">db</span><span class="s7">,</span><span class="s1"> </span><span class="s8">`/artifacts/</span><span class="s7">${</span><span class="s1">appId</span><span class="s7">}</span><span class="s8">/users/</span><span class="s7">${</span><span class="s1">userId</span><span class="s7">}</span><span class="s8">/memos`</span><span class="s7">,</span><span class="s1"> memoId</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">await</span><span class="s1"> updateDoc</span><span class="s7">(</span><span class="s1">memoRef</span><span class="s7">,</span><span class="s1"> updatedFields</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>toggleLoader</span><span class="s7">(</span><span class="s12">false</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Bravo!"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">`Promemoria aggiornato. Prossimo ripasso: </span><span class="s7">${</span><span class="s4">formatDate</span><span class="s7">(</span><span class="s4">nextReviewDate</span><span class="s7">)}</span><span class="s1">`</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>toggleLoader</span><span class="s7">(</span><span class="s12">false</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">"Errore nell'aggiornamento del promemoria:"</span><span class="s7">,</span><span class="s4"> error</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Errore"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"Impossibile aggiornare il promemoria. Riprova."</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Funzione per eliminare un promemoria</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">async</span><span class="s1"> </span><span class="s12">function</span><span class="s1"> deleteMemo</span><span class="s7">(</span><span class="s1">memoId</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>toggleLoader</span><span class="s7">(</span><span class="s12">true</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> memoRef </span><span class="s7">=</span><span class="s1"> doc</span><span class="s7">(</span><span class="s1">db</span><span class="s7">,</span><span class="s1"> </span><span class="s8">`/artifacts/</span><span class="s7">${</span><span class="s1">appId</span><span class="s7">}</span><span class="s8">/users/</span><span class="s7">${</span><span class="s1">userId</span><span class="s7">}</span><span class="s8">/memos`</span><span class="s7">,</span><span class="s1"> memoId</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">await</span><span class="s1"> deleteDoc</span><span class="s7">(</span><span class="s1">memoRef</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>toggleLoader</span><span class="s7">(</span><span class="s12">false</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Fatto"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"Promemoria eliminato."</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>toggleLoader</span><span class="s7">(</span><span class="s12">false</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">"Errore nell'eliminazione del promemoria:"</span><span class="s7">,</span><span class="s4"> error</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Errore"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"Impossibile eliminare il promemoria. Riprova."</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Variabile per tenere traccia dei promemoria già notificati (per evitare spam)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> notifiedMemos </span><span class="s7">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Set</span><span class="s7">();</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Gestione dell'Interfaccia Utente e Renderizzazione ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> renderMemos</span><span class="s7">(</span><span class="s1">memos</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> list </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'memosList'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>list</span><span class="s7">.</span><span class="s1">innerHTML </span><span class="s7">=</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> today </span><span class="s7">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Date</span><span class="s7">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>currentMemosList </span><span class="s7">=</span><span class="s1"> memos</span><span class="s7">;</span><span class="s1"> </span><span class="s10">// Aggiorna la lista locale</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">memos</span><span class="s7">.</span><span class="s1">length </span><span class="s7">===</span><span class="s1"> </span><span class="s13">0</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>list</span><span class="s7">.</span><span class="s4">innerHTML </span><span class="s7">=</span><span class="s4"> </span><span class="s1">'&lt;p class="text-center text-gray-500 p-8 card rounded-xl"&gt;Non ci sono promemoria. Aggiungine uno per iniziare!&lt;/p&gt;'</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">return</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// --- Logica di Ordinamento per Urgenza (Next Review) ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>memos</span><span class="s7">.</span><span class="s1">sort</span><span class="s7">((</span><span class="s1">a</span><span class="s7">,</span><span class="s1"> b</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Firebase timestamp to Date object conversion</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> aNextReview </span><span class="s7">=</span><span class="s1"> a</span><span class="s7">.</span><span class="s1">nextReview</span><span class="s7">.</span><span class="s1">toDate</span><span class="s7">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> bNextReview </span><span class="s7">=</span><span class="s1"> b</span><span class="s7">.</span><span class="s1">nextReview</span><span class="s7">.</span><span class="s1">toDate</span><span class="s7">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> aIsDue </span><span class="s7">=</span><span class="s1"> aNextReview </span><span class="s7">&lt;=</span><span class="s1"> today</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> bIsDue </span><span class="s7">=</span><span class="s1"> bNextReview </span><span class="s7">&lt;=</span><span class="s1"> today</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 1. Priorità assoluta ai promemoria 'scaduti' (isDue = true)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">aIsDue </span><span class="s7">&amp;&amp;</span><span class="s1"> </span><span class="s7">!</span><span class="s1">bIsDue</span><span class="s7">)</span><span class="s1"> </span><span class="s12">return</span><span class="s1"> </span><span class="s7">-</span><span class="s13">1</span><span class="s7">;</span><span class="s1"> </span><span class="s10">// 'a' viene prima di 'b'</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">aIsDue </span><span class="s7">&amp;&amp;</span><span class="s1"> bIsDue</span><span class="s7">)</span><span class="s1"> </span><span class="s12">return</span><span class="s1"> </span><span class="s13">1</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space">  </span></span><span class="s10">// 'b' viene prima di 'a'</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// 2. Se entrambi o nessuno sono scaduti, ordina per data di prossimo ripasso (la più vicina va prima)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">return</span><span class="s1"> aNextReview</span><span class="s7">.</span><span class="s1">getTime</span><span class="s7">()</span><span class="s1"> </span><span class="s7">-</span><span class="s1"> bNextReview</span><span class="s7">.</span><span class="s1">getTime</span><span class="s7">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>memos</span><span class="s7">.</span><span class="s1">forEach</span><span class="s7">(</span><span class="s1">memo </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> nextReviewDate </span><span class="s7">=</span><span class="s1"> memo</span><span class="s7">.</span><span class="s1">nextReview</span><span class="s7">.</span><span class="s1">toDate</span><span class="s7">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> isDue </span><span class="s7">=</span><span class="s1"> nextReviewDate </span><span class="s7">&lt;=</span><span class="s1"> today</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> daysUntilReview </span><span class="s7">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s7">.</span><span class="s1">ceil</span><span class="s7">((</span><span class="s1">nextReviewDate </span><span class="s7">-</span><span class="s1"> today</span><span class="s7">)</span><span class="s1"> </span><span class="s7">/</span><span class="s1"> </span><span class="s7">(</span><span class="s13">1000</span><span class="s1"> </span><span class="s7">*</span><span class="s1"> </span><span class="s13">60</span><span class="s1"> </span><span class="s7">*</span><span class="s1"> </span><span class="s13">60</span><span class="s1"> </span><span class="s7">*</span><span class="s1"> </span><span class="s13">24</span><span class="s7">));</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">let</span><span class="s1"> statusClass </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'review-ok'</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">let</span><span class="s1"> statusText </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`Prossimo ripasso: </span><span class="s7">${</span><span class="s1">formatDate</span><span class="s7">(</span><span class="s1">nextReviewDate</span><span class="s7">)}</span><span class="s8">. (Intervallo </span><span class="s7">${</span><span class="s1">memo</span><span class="s7">.</span><span class="s1">intervalIndex </span><span class="s7">+</span><span class="s1"> </span><span class="s13">1</span><span class="s7">}</span><span class="s8">/</span><span class="s7">${</span><span class="s14">REPETITION_INTERVALS</span><span class="s7">.</span><span class="s1">length</span><span class="s7">}</span><span class="s8">)`</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">let</span><span class="s1"> reviewButtonText </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'Ho Ripassato'</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Prepara il testo del promemoria per la visualizzazione<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> displayContent </span><span class="s7">=</span><span class="s1"> memo</span><span class="s7">.</span><span class="s1">content</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> hasFile </span><span class="s7">=</span><span class="s1"> </span><span class="s7">!!</span><span class="s1">memo</span><span class="s7">.</span><span class="s1">fileBase64</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">isDue</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>statusClass </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'review-due'</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>statusText </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'🚨 **DA RIPASSARE SUBITO!**'</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>reviewButtonText </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'Ho Ripassato ORA'</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Invia notifica se dovuto e non ancora notificato</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">notifiedMemos</span><span class="s7">.</span><span class="s1">has</span><span class="s7">(</span><span class="s1">memo</span><span class="s7">.</span><span class="s1">id</span><span class="s7">))</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>sendDueNotification</span><span class="s7">(</span><span class="s1">memo</span><span class="s7">.</span><span class="s1">content</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>notifiedMemos</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s1">memo</span><span class="s7">.</span><span class="s1">id</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">daysUntilReview </span><span class="s7">&lt;=</span><span class="s1"> </span><span class="s13">3</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>statusClass </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'review-soon'</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>statusText </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`Prossimo ripasso tra </span><span class="s7">${</span><span class="s1">daysUntilReview</span><span class="s7">}</span><span class="s8"> giorni.`</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Rimuovi dalla lista dei notificati se non è più dovuto</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">isDue </span><span class="s7">&amp;&amp;</span><span class="s1"> notifiedMemos</span><span class="s7">.</span><span class="s1">has</span><span class="s7">(</span><span class="s1">memo</span><span class="s7">.</span><span class="s1">id</span><span class="s7">))</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>notifiedMemos</span><span class="s7">.</span><span class="s12">delete</span><span class="s7">(</span><span class="s1">memo</span><span class="s7">.</span><span class="s1">id</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Bottone aggiuntivo per l'apertura del file</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> openFileButton </span><span class="s7">=</span><span class="s1"> hasFile </span><span class="s7">?</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button data-id="</span><span class="s7">${</span><span class="s4">memo</span><span class="s7">.</span><span class="s4">id</span><span class="s7">}</span><span class="s1">"<span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>class="btn-open-file btn-primary py-2 px-4 rounded-lg text-sm font-medium whitespace-nowrap"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>Apri File</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span>`</span><span class="s4"> </span><span class="s7">:</span><span class="s4"> </span><span class="s1">''</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> cardHtml </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="card p-5 rounded-xl flex flex-col md:flex-row items-start md:items-center justify-between </span><span class="s7">${</span><span class="s4">statusClass</span><span class="s7">}</span><span class="s1">"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="mb-4 md:mb-0 md:w-3/5"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-lg font-semibold text-gray-800"&gt;</span><span class="s7">${</span><span class="s4">displayContent</span><span class="s7">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">${</span><span class="s4">hasFile </span><span class="s7">?</span><span class="s4"> </span><span class="s1">`&lt;p class="text-xs text-indigo-500 mt-1 italic"&gt;File allegato (</span><span class="s7">${</span><span class="s4">memo</span><span class="s7">.</span><span class="s4">fileMimeType</span><span class="s7">}</span><span class="s1">)&lt;/p&gt;`</span><span class="s4"> </span><span class="s7">:</span><span class="s4"> </span><span class="s1">''</span><span class="s7">}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-sm text-gray-500 mt-1"&gt;</span><span class="s7">${</span><span class="s4">statusText</span><span class="s7">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex space-x-2 w-full md:w-auto justify-end"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">${</span><span class="s4">openFileButton</span><span class="s7">}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button data-id="</span><span class="s7">${</span><span class="s4">memo</span><span class="s7">.</span><span class="s4">id</span><span class="s7">}</span><span class="s1">" data-index="</span><span class="s7">${</span><span class="s4">memo</span><span class="s7">.</span><span class="s4">intervalIndex</span><span class="s7">}</span><span class="s1">"</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                    </span>class="btn-review py-2 px-4 rounded-lg text-sm font-medium whitespace-nowrap"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">${</span><span class="s4">reviewButtonText</span><span class="s7">}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button data-id="</span><span class="s7">${</span><span class="s4">memo</span><span class="s7">.</span><span class="s4">id</span><span class="s7">}</span><span class="s1">" class="btn-delete bg-red-500 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-red-600 transition"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>Elimina</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span>`</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>list</span><span class="s7">.</span><span class="s1">insertAdjacentHTML</span><span class="s7">(</span><span class="s8">'beforeend'</span><span class="s7">,</span><span class="s1"> cardHtml</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Aggiunge i listener ai pulsanti dinamici</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>list</span><span class="s7">.</span><span class="s1">querySelectorAll</span><span class="s7">(</span><span class="s8">'.btn-review'</span><span class="s7">).</span><span class="s1">forEach</span><span class="s7">(</span><span class="s1">button </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>button</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">const</span><span class="s1"> id </span><span class="s7">=</span><span class="s1"> e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">dataset</span><span class="s7">.</span><span class="s1">id</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">const</span><span class="s1"> index </span><span class="s7">=</span><span class="s1"> parseInt</span><span class="s7">(</span><span class="s1">e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">dataset</span><span class="s7">.</span><span class="s1">index</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>reviewMemo</span><span class="s7">(</span><span class="s1">id</span><span class="s7">,</span><span class="s1"> index</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>list</span><span class="s7">.</span><span class="s1">querySelectorAll</span><span class="s7">(</span><span class="s8">'.btn-delete'</span><span class="s7">).</span><span class="s1">forEach</span><span class="s7">(</span><span class="s1">button </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>button</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">const</span><span class="s1"> id </span><span class="s7">=</span><span class="s1"> e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">dataset</span><span class="s7">.</span><span class="s1">id</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>deleteMemo</span><span class="s7">(</span><span class="s1">id</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Listener per il nuovo pulsante "Apri File"</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>list</span><span class="s7">.</span><span class="s1">querySelectorAll</span><span class="s7">(</span><span class="s8">'.btn-open-file'</span><span class="s7">).</span><span class="s1">forEach</span><span class="s7">(</span><span class="s1">button </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>button</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">const</span><span class="s1"> id </span><span class="s7">=</span><span class="s1"> e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">dataset</span><span class="s7">.</span><span class="s1">id</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">const</span><span class="s1"> memo </span><span class="s7">=</span><span class="s1"> currentMemosList</span><span class="s7">.</span><span class="s1">find</span><span class="s7">(</span><span class="s1">m </span><span class="s7">=&gt;</span><span class="s1"> m</span><span class="s7">.</span><span class="s1">id </span><span class="s7">===</span><span class="s1"> id</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">memo </span><span class="s7">&amp;&amp;</span><span class="s1"> memo</span><span class="s7">.</span><span class="s1">fileBase64 </span><span class="s7">&amp;&amp;</span><span class="s1"> memo</span><span class="s7">.</span><span class="s1">fileMimeType</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>openFileInNewTab</span><span class="s7">(</span><span class="s1">memo</span><span class="s7">.</span><span class="s1">fileBase64</span><span class="s7">,</span><span class="s1"> memo</span><span class="s7">.</span><span class="s1">fileMimeType</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                        </span>showModal</span><span class="s7">(</span><span class="s1">"Errore"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"Dati file mancanti o non validi."</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Listener in Tempo Reale di Firestore ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> setupRealtimeListener</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> memosColRef </span><span class="s7">=</span><span class="s1"> collection</span><span class="s7">(</span><span class="s1">db</span><span class="s7">,</span><span class="s1"> </span><span class="s8">`/artifacts/</span><span class="s7">${</span><span class="s1">appId</span><span class="s7">}</span><span class="s8">/users/</span><span class="s7">${</span><span class="s1">userId</span><span class="s7">}</span><span class="s8">/memos`</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> q </span><span class="s7">=</span><span class="s1"> memosColRef</span><span class="s7">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot</span><span class="s7">(</span><span class="s1">q</span><span class="s7">,</span><span class="s1"> </span><span class="s7">(</span><span class="s1">snapshot</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">loadingStatusElement</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>loadingStatusElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> memos </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>snapshot</span><span class="s7">.</span><span class="s1">forEach</span><span class="s7">(</span><span class="s1">doc </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>memos</span><span class="s7">.</span><span class="s1">push</span><span class="s7">({</span><span class="s1"> id</span><span class="s7">:</span><span class="s1"> doc</span><span class="s7">.</span><span class="s1">id</span><span class="s7">,</span><span class="s1"> </span><span class="s7">...</span><span class="s1">doc</span><span class="s7">.</span><span class="s1">data</span><span class="s7">()</span><span class="s1"> </span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>renderMemos</span><span class="s7">(</span><span class="s1">memos</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">},</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">"Errore nel listener in tempo reale:"</span><span class="s7">,</span><span class="s4"> error</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">loadingStatusElement</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>loadingStatusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s8">"Errore di connessione ai promemoria."</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Errore Live"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"Problemi di connessione al feed dati: "</span><span class="s4"> </span><span class="s7">+</span><span class="s4"> error</span><span class="s7">.</span><span class="s4">message</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Funzione per l'Avvio dell'App ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">async</span><span class="s1"> </span><span class="s12">function</span><span class="s1"> startApplicationLogic</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">             </span></span><span class="s1">// RICHIESTA DEL PERMESSO DI NOTIFICA</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>requestNotificationPermission</span><span class="s7">();</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">             </span></span><span class="s1">// Inizializzazione Firebase</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> app </span><span class="s7">=</span><span class="s1"> initializeApp</span><span class="s7">(</span><span class="s1">firebaseConfig</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>db </span><span class="s7">=</span><span class="s1"> getFirestore</span><span class="s7">(</span><span class="s1">app</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>auth </span><span class="s7">=</span><span class="s1"> getAuth</span><span class="s7">(</span><span class="s1">app</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// =========================================================================</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// === PASSO 2: AUTENTICAZIONE (USIAMO SOLO ANONIMA IN AMBIENTE ESTERNO) ===</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// =========================================================================</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Usiamo solo 'signInAnonymously' per il funzionamento con una singola istanza non autenticata.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">await</span><span class="s1"> signInAnonymously</span><span class="s7">(</span><span class="s1">auth</span><span class="s7">);</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// =========================================================================</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>userId </span><span class="s7">=</span><span class="s1"> auth</span><span class="s7">.</span><span class="s1">currentUser</span><span class="s7">.</span><span class="s1">uid</span><span class="s7">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s4">log</span><span class="s7">(</span><span class="s1">"Firebase e Autenticazione completate. UserID:"</span><span class="s7">,</span><span class="s4"> userId</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Recupera gli elementi DOPO che il DOM è caricato e li cacha</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>loaderElement </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'loader'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>loadingStatusElement </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'loadingStatus'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> addMemoBtn </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'addMemoBtn'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> memoInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'memoInput'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> fileInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'fileInput'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> fileStatusElement </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'fileStatus'</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">loadingStatusElement</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>loadingStatusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s8">"Caricamento in corso..."</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>setupRealtimeListener</span><span class="s7">();</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// --- GESTIONE DEL CARICAMENTO DEL FILE (senza sintesi AI) ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>fileInput</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'change'</span><span class="s7">,</span><span class="s1"> </span><span class="s12">async</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">const</span><span class="s1"> file </span><span class="s7">=</span><span class="s1"> e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">files</span><span class="s7">[</span><span class="s13">0</span><span class="s7">];</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Reset delle variabili globali</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>uploadedFileBase64 </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>uploadedFileMimeType </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">file</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>fileStatusElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s12">return</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Verifica della dimensione del file</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">file</span><span class="s7">.</span><span class="s1">size </span><span class="s7">&gt;</span><span class="s1"> </span><span class="s14">MAX_FILE_SIZE_KB</span><span class="s1"> </span><span class="s7">*</span><span class="s1"> </span><span class="s13">1024</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s12">const</span><span class="s1"> fileSizeKB </span><span class="s7">=</span><span class="s1"> </span><span class="s7">(</span><span class="s1">file</span><span class="s7">.</span><span class="s1">size </span><span class="s7">/</span><span class="s1"> </span><span class="s13">1024</span><span class="s7">).</span><span class="s1">toFixed</span><span class="s7">(</span><span class="s13">2</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s12">const</span><span class="s4"> errorMessage </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`Il file (</span><span class="s7">${</span><span class="s4">fileSizeKB</span><span class="s7">}</span><span class="s1"> KB) supera il limite massimo di </span><span class="s7">${</span><span class="s14">MAX_FILE_SIZE_KB</span><span class="s7">}</span><span class="s1"> KB. Si prega di caricare file più piccoli.`</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s8">"ERRORE DI CARICAMENTO:"</span><span class="s7">,</span><span class="s1"> errorMessage</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>showModal</span><span class="s7">(</span><span class="s8">"File troppo grande"</span><span class="s7">,</span><span class="s1"> errorMessage</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>fileStatusElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s12">return</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">const</span><span class="s1"> mimeType </span><span class="s7">=</span><span class="s1"> file</span><span class="s7">.</span><span class="s1">type</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// --- Logica UNIFICATA per file supportati (TXT, PDF, Immagini) ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">mimeType </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'text/plain'</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> file</span><span class="s7">.</span><span class="s1">name</span><span class="s7">.</span><span class="s1">endsWith</span><span class="s7">(</span><span class="s8">'.txt'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> mimeType</span><span class="s7">.</span><span class="s1">startsWith</span><span class="s7">(</span><span class="s8">'image/'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> mimeType </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'application/pdf'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s12">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>toggleLoader</span><span class="s7">(</span><span class="s12">true</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>fileStatusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`Caricamento di "</span><span class="s7">${</span><span class="s1">file</span><span class="s7">.</span><span class="s1">name</span><span class="s7">}</span><span class="s8">" in corso...`</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>fileStatusElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">// 1. Converti in Base64</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s12">const</span><span class="s1"> base64Data </span><span class="s7">=</span><span class="s1"> </span><span class="s12">await</span><span class="s1"> readFileAsBase64</span><span class="s7">(</span><span class="s1">file</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                            </span></span><span class="s1">// 2. Salva i dati Base64 completi per l'apertura</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>uploadedFileBase64 </span><span class="s7">=</span><span class="s1"> base64Data</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>uploadedFileMimeType </span><span class="s7">=</span><span class="s1"> mimeType</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                            </span></span><span class="s1">// 3. Aggiorna lo stato e suggerisce un nome all'utente</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s12">const</span><span class="s1"> suggestedName </span><span class="s7">=</span><span class="s1"> file</span><span class="s7">.</span><span class="s1">name</span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/\.[^/.]+$/</span><span class="s7">,</span><span class="s1"> </span><span class="s8">""</span><span class="s7">);</span><span class="s1"> </span><span class="s10">// Nome file senza estensione</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>fileStatusElement</span><span class="s7">.</span><span class="s4">textContent </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`File "</span><span class="s7">${</span><span class="s4">file</span><span class="s7">.</span><span class="s4">name</span><span class="s7">}</span><span class="s1">" caricato. Inserisci il nome che vuoi dare al promemoria e premi 'Aggiungi Promemoria'.`</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>memoInput</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> suggestedName</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                            </span></span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>console</span><span class="s7">.</span><span class="s4">log</span><span class="s7">(</span><span class="s1">`File caricato con successo: </span><span class="s7">${</span><span class="s4">file</span><span class="s7">.</span><span class="s4">name</span><span class="s7">}</span><span class="s1">. Sintesi AI saltata come richiesto.`</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s8">"ERRORE DI ELABORAZIONE FILE:"</span><span class="s7">,</span><span class="s1"> error</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showModal</span><span class="s7">(</span><span class="s1">"Errore di Elaborazione"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">`Impossibile caricare il file. Errore: </span><span class="s7">${</span><span class="s4">error</span><span class="s7">.</span><span class="s4">message</span><span class="s7">}</span><span class="s1">`</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>uploadedFileBase64 </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>uploadedFileMimeType </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>fileInput</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>fileStatusElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>memoInput</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">finally</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>toggleLoader</span><span class="s7">(</span><span class="s12">false</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s12">return</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// --- Logica per file non supportati ---</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s12">const</span><span class="s4"> errorMessage </span><span class="s7">=</span><span class="s4"> </span><span class="s1">"Formato file non supportato. Per favore, carica un file TXT, PDF o JPEG."</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s8">"ERRORE DI CARICAMENTO:"</span><span class="s7">,</span><span class="s1"> errorMessage</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>showModal</span><span class="s7">(</span><span class="s8">"Formato non supportato"</span><span class="s7">,</span><span class="s1"> errorMessage</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s12">null</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>fileStatusElement</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event Listener per l'UI</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s7">(</span><span class="s1">addMemoBtn</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>addMemoBtn</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> addMemo</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s7">(</span><span class="s1">memoInput</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>memoInput</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'keypress'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">.</span><span class="s1">key </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'Enter'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>addMemo</span><span class="s7">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s12">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s4">error</span><span class="s7">(</span><span class="s1">"Errore nell'inizializzazione di Firebase o nell'autenticazione:"</span><span class="s7">,</span><span class="s4"> error</span><span class="s7">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showModal</span><span class="s7">(</span><span class="s1">"Errore di Caricamento"</span><span class="s7">,</span><span class="s4"> </span><span class="s1">"Non è stato possibile connettersi al database: "</span><span class="s4"> </span><span class="s7">+</span><span class="s4"> error</span><span class="s7">.</span><span class="s4">message</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">loadingStatusElement</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>loadingStatusElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s8">"Impossibile caricare i promemoria."</span><span class="s7">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Avvia l'app solo quando il DOM è completamente caricato</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>document</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'DOMContentLoaded'</span><span class="s7">,</span><span class="s1"> startApplicationLogic</span><span class="s7">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
</body>
</html>
